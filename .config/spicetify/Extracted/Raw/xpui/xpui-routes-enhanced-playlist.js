"use strict";(("undefined"!=typeof self?self:global).webpackChunkopen=("undefined"!=typeof self?self:global).webpackChunkopen||[]).push([[682],{34738:(e,t,n)=>{n.r(t),n.d(t,{EnhancedPlaylist:()=>N,default:()=>T});var l=n(20657),i=n(67294),a=n.n(i),r=n(30947),o=n(67379),s=n(55911),c=n(20246),d=n(18261),u=n(58548),m=n(76343),p=n(43620),y=n(59713),g=n.n(y),b=n(21931),f=n(42781),v=n(69518),E=n.n(v),h=n(9273),O=n(36447);function k(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);t&&(l=l.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,l)}return n}function w(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?k(Object(n),!0).forEach((function(t){g()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):k(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function x(e,t=!1){var n,l,a;const r=null===(n=E().from(e))||void 0===n?void 0:n.getBase62Id(),o=(0,h._)(),{isEnhanced:s,iteration:c,setIsEnhanced:d,toggleIsEnhanced:u}=(0,O.U)(e),[m,p]=(0,i.useState)(!1),[y,g]=(0,i.useState)(null),v=(0,i.useCallback)(((e,t)=>{p(!0),o.getState(e,t).then((e=>{p(!1),g(e)}))}),[o]);(0,i.useEffect)((()=>{s&&r?v(r,c):g(null)}),[s,r,v,c]);const k=(null==y||null===(l=y.items)||void 0===l||null===(a=l.filter(Boolean))||void 0===a?void 0:a.map((e=>null==e?void 0:e.uri)))||[],x=(0,b._)(k,t).filter((e=>"track"===(null==e?void 0:e.type))),P=(0,i.useMemo)((()=>function(e,t){return e.filter(Boolean).map(((e,n)=>{var l,i,a,r,o,s,c,d,u,m,p,y,g,b,v,h,O,k,x;return w(w({},e),{},{type:f.p.TRACK,duration:{milliseconds:e.duration_ms},discNumber:"track"===e.type&&e.disc_number,trackNumber:"track"===e.type&&e.track_number,isPlayable:e.is_playable,isExplicit:"track"===e.type&&e.explicit,id:null==t||null===(l=t.items)||void 0===l||null===(i=l[n])||void 0===i?void 0:i.itemId,uid:null==t||null===(a=t.items)||void 0===a||null===(r=a[n])||void 0===r?void 0:r.itemId,playIndex:n,addedAt:null,addedBy:{type:f.p.USER,uri:E().profileURI(null==t||null===(o=t.items)||void 0===o||null===(s=o[n])||void 0===s||null===(c=s.itemAttributes)||void 0===c?void 0:c.addedBy).toURI(),username:null==t||null===(d=t.items)||void 0===d||null===(u=d[n])||void 0===u||null===(m=u.itemAttributes)||void 0===m?void 0:m.addedBy},uri:e.uri,formatListAttributes:{enhancedRec:null!=t&&null!==(p=t.items)&&void 0!==p&&null!==(y=p[n])&&void 0!==y&&null!==(g=y.itemAttributes)&&void 0!==g&&g.enhancedRec?"true":"false",seedIndex:null==t||null===(b=t.items)||void 0===b||null===(v=b[n])||void 0===v||null===(h=v.itemAttributes)||void 0===h||null===(O=h.seedIndex)||void 0===O?void 0:O.toString()},isLocal:!1,is19PlusOnly:!(null==e||null===(k=e.tags)||void 0===k||null===(x=k.includes)||void 0===x||!x.call(k,"MOGEF-19+"))})}))}(x,y)),[x,y]),I=(0,i.useCallback)((async({trackUri:e,itemId:t,seedIndex:n})=>{if(!y)return;const{enhanceState:l,status:i}=await o.addRecommendation(r,y.sessionId,y.playlistRevision,e,t,n);409===i?v(r,c):g(l)}),[y,r,o,v,c]),C=(0,i.useCallback)((async({trackUri:e})=>{if(!y)return;const{enhanceState:t,status:n}=await o.removeRecommendation(r,y.sessionId,e);409===n?v(r,c):g(t)}),[y,r,o,v,c]),j=(0,i.useMemo)((()=>({uri:e,url:null==y?void 0:y.dspContextUri})),[e,null==y?void 0:y.dspContextUri]);return{isEnhanced:s,setIsEnhanced:d,toggleIsEnhanced:u,isLoading:m,addRecommendation:I,removeRecommendation:C,tracks:P,playContext:j}}var P=n(84242),I=n(95661),C=n(35410),j=n(70369),S=n(37338),_=n(53424),D=n(59482),L=n(72907),U=n(67892),B=n(55120),R=n(24172);const A={xs:"(min-width: 0px)",xsOnly:"(min-width: 0px) and (max-width: 767px)",sm:"(min-width: 768px)",smOnly:"(min-width: 768px) and (max-width: 1023px)",md:"(min-width: 1024px)",mdOnly:"(min-width: 1024px) and (max-width: 1279px)",lg:"(min-width: 1280px)",lgOnly:"(min-width: 1280px) and (max-width: 1919px)",xl:"(min-width: 1920px)",enhancedPlaylist:"HX0u0G8bBbI9FFQE9JW5",playlistImageContainer:"_6eIkE1hgff_QOJxjB_H"},N=a().memo((({metadata:e})=>{const{uri:t,name:n,description:y,images:g,totalLength:b,totalLikes:f,duration:v,owner:E,isOwnedBySelf:h,isCollaborative:O,canPlay:k}=e,w=h,N=(0,i.useMemo)((()=>[{id:E.username,uri:E.uri,name:E.username,displayName:E.displayName||void 0,images:E.images}]),[E]),[T]=g,F=(0,p.Z)((null==T?void 0:T.url)||null),M=(0,i.useContext)(R.zy),Q=(0,i.useCallback)((e=>{M({type:"open",playlistDetails:{name:n,description:y,image:T,uri:t},focusedElement:e})}),[M,n,y,T,t]),z=(0,i.useCallback)((()=>{M({type:"openWithImagePicker",playlistDetails:{name:n,description:y,image:T,uri:t}})}),[M,n,y,T,t]),{playContext:X}=x(t,!0),{isPlaying:$,togglePlay:G}=(0,P.n)(X,{featureIdentifier:"playlist"}),W=(0,i.useCallback)((()=>G()),[G]);return a().createElement(i.Suspense,{fallback:null},a().createElement(j.$,null,l.ag.get("playlist.page-title",n)),a().createElement("section",{role:"presentation",className:A.enhancedPlaylist,"data-testid":"enhanced-playlist-page"},a().createElement(_.gF,{backgroundColor:F},a().createElement(D.W,null,a().createElement(B.$,{size:s.qE.sm,onClick:W,isPlaying:$,uri:t}),a().createElement(L.i,{text:n,dragUri:t,dragLabel:n})),a().createElement(d._,{menu:a().createElement(C.X,{uri:t})},a().createElement("div",{className:A.playlistImageContainer},a().createElement(S.T,{canEdit:w,name:n,images:g,onClick:z,placeholderType:"playlist",dragUri:t}))),a().createElement(_.sP,null,a().createElement(_.dy,{small:!0,uppercase:!0},O?l.ag.get("sidebar.collaborative_playlist"):l.ag.get("playlist")),a().createElement(d._,{menu:a().createElement(C.X,{uri:t})},a().createElement(_.xd,{canEdit:w,onClick:()=>Q(R.w.TITLE),dragUri:t,dragLabel:n,ariaLabel:l.ag.get("playlist.edit-details.button",n)},n)),y&&a().createElement(_.dy,{bold:!1,gray:!0},a().createElement(u.kf,{paragraphClassName:A.playlistDescription,source:y,LinkComponent:U.r,variant:m.$e.viola})),a().createElement(_.QS,{creators:N,totalTracks:b,totalLikes:f||0,durationMilliseconds:null==v?void 0:v.milliseconds,isEstimatedDuration:null==v?void 0:v.isEstimate}))),a().createElement("div",{className:A.playlistContent},a().createElement(r.o,{backgroundColor:F},a().createElement(r.F,null,k?a().createElement(B.$,{onClick:W,isPlaying:$,size:s.qE.lg,uri:t}):null,a().createElement(o.v,{uri:t}),a().createElement(c.y,{menu:a().createElement(C.X,{uri:t})},a().createElement(I.z,null)))))))})),T=N},21931:(e,t,n)=>{n.d(t,{_:()=>p});var l=n(59713),i=n.n(l),a=n(67294),r=n(69518),o=n.n(r),s=n(66227),c=n(80624);function d(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);t&&(l=l.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,l)}return n}function u(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?d(Object(n),!0).forEach((function(t){i()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):d(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}const m=[];function p(e,t=!0){const[n,l]=(0,a.useState)({});return(0,a.useEffect)((()=>{if(!t)return;const i=Array.from(new Set(e)),a=i.filter((e=>o().isTrack(e)&&!n[e])),r=i.filter((e=>o().isEpisode(e)&&!n[e])),d=a.length?s.fQ.getTracks(c.b.getInstance(),a.map((e=>o().from(e).getBase62Id()))).then((e=>e.body.tracks||m)):Promise.resolve(m),p=r.map((e=>s.UY.getEpisodeGraphQL(c.b.getInstance(),o().from(e).getBase62Id()).then((e=>(null==e?void 0:e.body)||{})).catch((t=>(console.error(t),{uri:e})))));Promise.all([d,...p]).then((([e,...t])=>{const n={},i={};e.forEach((e=>{var t;n[(null==e||null===(t=e.linked_from)||void 0===t?void 0:t.uri)||e.uri]=e})),t.forEach((e=>{i[e.uri]=e})),(e.length>0||t.length>0)&&l((e=>u(u(u({},e),n),i)))}))}),[e,n,t]),e.map((e=>n[e]))}}}]);
//# sourceMappingURL=xpui-routes-enhanced-playlist.js.map