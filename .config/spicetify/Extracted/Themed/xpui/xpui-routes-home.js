"use strict";(("undefined"!=typeof self?self:global).webpackChunkopen=("undefined"!=typeof self?self:global).webpackChunkopen||[]).push([[807],{85815:(e,t,n)=>{n.r(t),n.d(t,{HOME_REFRESH_TIMEOUT:()=>k,default:()=>x});var a=n(67294),r=n.n(a),s=n(94184),o=n.n(s),c=n(65858),l=n(76092),i=n(17231),u=n(44503),m=n(73546),d=n(28638);const f=()=>(0,i.Sq)(u.Jw)===u.pF.ONHOME?r().createElement(d.w,null,r().createElement(m.M,{onSearch:!1})):null;var g=n(1663),h=n(20657),p=n(79834),v=n(29255),E=n(5001),y=n(89294),_=n(92457),w=n(70369),S=n(13983),I=n(35808),b=n(8247),T=n(24872),R=n(35533),C=n(33607),A=n(80624),N=n(74845),L=n(23716);const P="PLAY_AT_FIRST_TAP_HAD_DEFERRED_ACTIONS",D=e=>{const t=(0,T.M)(),n=(0,R.x)(e);t.send(n)};function M(e){const t=(0,i.W6)(b.Qs),[n,r]=(0,a.useState)(void 0),[s,o]=(0,a.useState)(void 0),[l,u]=(0,a.useState)(!1),m=(0,L.g)(),d=(0,c.v9)((({session:e})=>e.user&&e.user.id));(0,a.useEffect)((()=>{o(!!window.sessionStorage.getItem(P)&&(window.sessionStorage.removeItem(P),!0))}),[]),(0,a.useEffect)((()=>{d&&(D({category:"play-at-first-tap",label:"log_attempt",os:(0,C.y)(),context:"ab_v3"}),u((e=>!!window.sessionStorage.getItem(`PLAY_AT_FIRST_TAP_APPLIED_${e}`))(d)),(0,N.M)(A.b.getInstance()).then((e=>{r(e.content.items.length>0)})).catch((()=>{D({category:"play-at-first-tap",label:"recently-played-failed",os:(0,C.y)(),context:"ab_v3"}),r(!0)})))}),[d]),(0,a.useEffect)((()=>{if(void 0===n||void 0===s||!e||!d||l)return;const a=!n&&!s;if(a){(e=>{window.sessionStorage.setItem(`PLAY_AT_FIRST_TAP_APPLIED_${e}`,JSON.stringify(!0))})(d);const n=(e=>{const t=e.content.items.find((e=>{const t="CAROUSEL"===e.rendering,n="LIST"===e.rendering&&"shortcuts"!==e.id;return t||n}));if(!t)return;const n=t.content.items.find((e=>!e.publisher||!e.publisher.startsWith("Spotify")));return n&&n.uri})(e);n&&t&&m.play({uri:n},{featureIdentifier:"home",referrerIdentifier:"home"},{paused:!0}),D({category:"play-at-first-tap",label:"play_content",os:(0,C.y)(),context:n||"no_valid_uri_retrieved"})}D({category:"play-state",label:a?"has_valid_state_yes":"has_valid_state_no",os:(0,C.y)(),context:"ab_v3"})}),[l,n,e,s,m,d,t])}const k=18e5,x=r().memo((()=>{const{isAnonymous:e}=(0,c.v9)(v.Gg),{status:t}=(0,_.h)(y.N9.SIGNUP),n=(0,E.v8)(e,t===y.b_.COMPLETE),{view:s,refreshContents:i}=(0,I.P)(n);(0,S.z)("home"),M(s);const u=(null==s?void 0:s.timestamp)||0;(0,a.useEffect)((()=>{const e=()=>{Date.now()>u+k&&i()};return window.addEventListener("focus",e),()=>{window.removeEventListener("focus",e)}}),[u,i]);const m=null==s?void 0:s.content.items;return r().createElement(r().Fragment,null,r().createElement(w.$,null,h.ag.get("page.generic-title")),r().createElement(a.Suspense,{fallback:null},r().createElement(f,null)),s?r().createElement("section",{"data-testid":"home-page"},r().createElement("div",{className:l.Z.home},r().createElement("div",{className:o()(l.Z.content,"contentSpacing")},r().createElement(p.c,{spaces:m,viewName:s.name,viewId:n,isAnonymous:e})))):r().createElement(g.h,{errorMessage:h.ag.get("error.not_found.title.page")}))}))},73546:(e,t,n)=>{n.d(t,{M:()=>R});var a=n(67294),r=n.n(a),s=n(94184),o=n.n(s),c=n(47886),l=n(69518),i=n.n(l),u=n(20657),m=n(98742),d=n(86446);const f="_UTWTgKCqE8eruFNFAMf",g="G9iUss4eOSpJyn2VBzsS",h="AdgRS9ehCGsr8dvJ7IxK",p="c16n2m346Ss2TcRUx8Bw",v="g7ggq46CbOli19ZxJlQe",E="_6e_T5d5DVIdzLw3pCIw",y="BDcKgSW_ys9_Hj2DwDBW";var _=n(65858),w=n(1393),S=n(32648),I=n(64005),b=n(78034),T=n(57395);const R=r().memo((({onSearch:e=!0})=>{const t=(0,a.useRef)(null),n=(0,a.useRef)(null),s=(0,c.k6)(),l=(0,_.I0)(),[{category:R,query:C},A]=(0,T.l)(),[N,L]=(0,a.useState)(C),P=!!R,{scrollNodeRef:D}=r().useContext(S.VX),M=new URLSearchParams(location.search),k=Boolean(M.get("showRecent")),x=P||k,U=(0,I.y)(((e,t)=>{A(e,t),D.current&&(D.current.scrollTop=0)}),200);(0,a.useEffect)((()=>{!x&&e&&t.current!==document.activeElement&&(n.current=document.activeElement,t.current&&t.current.focus())}),[s.location.key,e,x]);return r().createElement("div",{className:o()(f,{[h]:!e})},r().createElement("form",{onSubmit:e=>{e.preventDefault();const t=i().from(N);var n,a;if(t)if(t.type===i().Type.AD){const e=i().idToHex(t.getBase62Id());if(t.getBase62Id()===e)return;l((0,w.HI)(e))}else s.push(t.toURLPath(!0));else N&&(null===(n=D.current)||void 0===n||null===(a=n.querySelector("h1, h2, h3, h4"))||void 0===a||a.focus())},role:"search"},r().createElement("input",{ref:t,className:o()(g,b.Z.mesto),value:N,maxLength:80,autoCorrect:"off",autoCapitalize:"off",spellCheck:!1,onChange:e=>{const t=e.currentTarget.value;L(t),U(t,x)},onKeyDown:e=>{"Escape"===e.key&&(N?(L(""),U("",x)):(t.current&&t.current.blur(),n.current instanceof HTMLElement&&n.current.focus()))},placeholder:e?u.ag.get("search.search-for-label"):u.ag.get("navbar.search"),onFocus:()=>{!x&&e||U(N,x)},"data-testid":"search-input"})),r().createElement("div",{className:E},r().createElement("span",{className:p},r().createElement(d.W,{size:24,viewBox:"0 0 512 512",className:y,"aria-hidden":!0})),N&&r().createElement("button",{className:v,onClick:()=>{t.current&&t.current.focus(),L(""),U("",x)},"aria-label":u.ag.get("search.a11y.clear-input")},r().createElement(m.T,{size:24,className:y}))))}))},57395:(e,t,n)=>{n.d(t,{l:()=>s});var a=n(67294),r=n(47886);function s(){const e=(0,r.k6)(),t=(0,r.$B)("/search/:query?/:category?"),n=(0,a.useCallback)((function(t,n){n?e.push(`/search/${encodeURIComponent(t)}`):e.replace(`/search/${encodeURIComponent(t)}`)}),[e]),s=function(e){try{return decodeURIComponent(e)}catch{return e}}((null==t?void 0:t.params.query)||""),o=null==t?void 0:t.params.category,c=(0,r.TH)(),l=new URLSearchParams(c.search);return[{query:s,category:o,showRecent:Boolean(l.get("showRecent"))},n]}},86446:(e,t,n)=>{n.d(t,{W:()=>o});var a=n(67294),r=n.n(a),s=n(87523);const o=e=>r().createElement(s.J,e,r().createElement("path",{d:"M349.714 347.937l93.714 109.969-16.254 13.969-93.969-109.969q-48.508 36.825-109.207 36.825-36.826 0-70.476-14.349t-57.905-38.603-38.603-57.905-14.349-70.476 14.349-70.476 38.603-57.905 57.905-38.603 70.476-14.349 70.476 14.349 57.905 38.603 38.603 57.905 14.349 70.476q0 37.841-14.73 71.619t-40.889 58.921zM224 377.397q43.428 0 80.254-21.461t58.286-58.286 21.461-80.254-21.461-80.254-58.286-58.285-80.254-21.46-80.254 21.46-58.285 58.285-21.46 80.254 21.46 80.254 58.285 58.286 80.254 21.461z",fill:"currentColor"}))}}]);
//# sourceMappingURL=xpui-routes-home.js.map